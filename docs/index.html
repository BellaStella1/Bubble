<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Interactive Bubble Popper</title>
    
    <style>
        /* CSS Styles remain the same */
        html, body {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            overflow: hidden; 
        }
        
        .wrap {
            height: 100%;
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
            text-align: center;
            padding: 20px;
            position: relative; 
        }
        
        #bubble-button { 
            font-size: clamp(48px, 10vw, 128px);
            transition: transform 0.1s; 
            cursor: pointer; 
            z-index: 10; 
            outline: none; 
            user-select: none; 
        }
        
        #bubble-button:active {
             transform: scale(0.95); 
        }

        #click-count {
            font-size: clamp(16px, 4vw, 24px); 
            margin-top: 20px;
            color: #00838f; 
            font-weight: bold;
            z-index: 10;
        }

        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-50vh) scale(0.5); 
            }
        }

        .floating-bubble {
            position: absolute;
            font-size: 30px; 
            pointer-events: none; 
            animation: float-up 2s ease-out forwards; 
            z-index: 5;
        }
    </style>
</head>
<body>
    
    <div class="wrap">
        <audio id="click-sound-fx" preload="auto">
            <source src="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU5LjE2LjEwMAAAAAAAAAAAAAAA//tEAAAAAAAoAAAJgAAAAAAAAAAAAAAARIAAAAASAAGACAAgAEAAJAAAAAAAAAAAASGJyZAAAAAAAAEAAAAAAAAAAGQQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/2wBIEAAAAQAAAKC4+gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQWxhdmY1OS4xNi4xMDAAAAAAAAAAAAAAAP/bMEVwAAAD8AAAAAAAAAAAAGQAAAQBAAAEAcAAAMBwAAAYCAAAABAAABAAABAAABAAMBBAMBBAcBBAYBAAECggIHBgYDAAYGBAQCBAcBAAEHBgYEAAgEBQQCAQYGBQQAAAECAAQDAwQCAgYDBgICAgYDBgICAgYDCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4WxEAAQAAAAsQAAAABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEtAVGRhdGECAgMEBQYHCQsNDxESFBgZGhoaHBwtLi8wMjQ3Ozw9PUFGSU1PUVFYWltaXGBkZWdpamoqbHB1fIKDg4iMjZCRkpSWl5iaoqOkpqmpra+wsbS2t7m7wMbIycnMzc/Q0dLT1NXW2Nnf3+Dl5ufn6Orq6+vt7vDx8vP09fX29vf4+fr7/P39/f4A" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
        
        <span id="bubble-button">ðŸ«§</span> 
        
        <p id="click-count">Total Clicks: 0</p> 
        
    </div>
    
    <script>
        let clickCount = parseInt(localStorage.getItem('bubbleClicks')) || 0; 
        
        const bubbleButton = document.getElementById('bubble-button'); 
        const countDisplay = document.getElementById('click-count');
        const wrapElement = document.querySelector('.wrap'); 
        const clickSound = document.getElementById('click-sound-fx'); 
        
        // This is a flag to track if the user has interacted once
        let hasInteracted = false; 
        
        clickSound.load(); 

        function updateTextDisplay() {
            countDisplay.textContent = 'Total Clicks: ' + clickCount;
        }

        function createFloatingBubble(x, y) {
            const newBubble = document.createElement('span');
            newBubble.textContent = 'ðŸ«§';
            newBubble.className = 'floating-bubble';
            
            const randomOffsetX = Math.random() * 50 - 25; 
            
            newBubble.style.left = `calc(${x}px + ${randomOffsetX}px - 15px)`; 
            newBubble.style.top = `${y}px`; 
            
            wrapElement.appendChild(newBubble);
            
            setTimeout(() => {
                newBubble.remove();
            }, 2000); 
        }
        
        // ðŸ’¡ NEW: Function to play sound reliably
        function playClickSound() {
            clickSound.currentTime = 0;
            // The play() promise helps us detect if playback failed (e.g., due to restrictions)
            clickSound.play().catch(error => {
                console.error("Autoplay was prevented:", error);
                // If playback fails once, we know the browser is blocking it.
            });
        }

        updateTextDisplay(); 
        
        function handleBubbleClick(event) {
            // 1. Mark the interaction
            if (!hasInteracted) {
                hasInteracted = true;
                // Attempt to play sound once to get permission from the browser
                playClickSound();
            } else {
                // If we already interacted, just play the sound immediately
                playClickSound();
            }
            
            clickCount += 1; 
            
            let clickX = event.clientX;
            let clickY = event.clientY;

            if (event.target === bubbleButton) {
                 const rect = bubbleButton.getBoundingClientRect();
                 clickX = rect.left + rect.width / 2;
                 clickY = rect.top + rect.height / 2;
            }

            createFloatingBubble(clickX, clickY);
            
            updateTextDisplay(); 
            localStorage.setItem('bubbleClicks', clickCount); 
        }

        // Attach event listeners
        bubbleButton.addEventListener('click', handleBubbleClick);
        wrapElement.addEventListener('click', (event) => {
             if (event.target !== bubbleButton) { 
                handleBubbleClick(event);
            }
        });
    </script>
    
</body>
</html>
